# /opt/entropywatcher/common.env *

##### DB #####
DB_HOST=<DB_HOST>
DB_PORT=3306
DB_NAME=entropywatcher
DB_USER=<DB_USER>
DB_PASS=<DB_PASSWORD>

##### Mail (gemeinsame Defaults; Service-spezifisches Branding in den *.env) #####
MAIL_ENABLE=1
MAIL_SMTP_HOST=mail.gmx.net
MAIL_SMTP_PORT=587
MAIL_STARTTLS=1

MAIL_TO=<YOUR_EMAIL>
MAIL_SSL=0
MAIL_PASS=<MAIL_PASSWORD>
MAIL_USER='<YOUR_EMAIL>'

# globales (Fallback) Rate-Limit-File – pro Service besser überschreiben!
MAIL_MIN_ALERT_INTERVAL_MIN=30
ALERT_STATE_FILE=/var/lib/entropywatcher/last_alert.txt

##### EntropyWatcher – allgemeine Defaults #####
# (OS-/NAS-spezifische EXCLUDES/SCAN_PATHS bleiben in den jeweiligen *.env)

# Minimale/Maximale Dateigröße (0 = kein Limit)
MIN_SIZE=1
MAX_SIZE=0


####################### START Detail-Doku ###################################
# Entropie-Engine
## USE_ENT=1                  # 'ent' verwenden (falls vorhanden)
## ENT_THRESHOLD=2097152      # ab 2 MiB 'ent', darunter NumPy (performant auf FUSE/NAS)
## ENT_TIMEOUT=30             # Sekunden Timeout für 'ent'
## CHUNK_SIZE=4194304         # 4 MiB Lese-Chunk
## WORKERS=3                  # Heavy-Worker-Prozesse

# Heuristiken / Härtung
## ALERT_ENTROPY_ABS=7.8      # absoluter Alarm-Schwellenwert (bits/Byte)
## ALERT_ENTROPY_JUMP=1.0     # Alarm, wenn Sprung ≥ 1.0 (relativ zur Baseline/prev)
## QUICK_FINGERPRINT=1        # Head/Tail-MD5 zur schnellen Änderungsdetektion
## QUICK_FP_SAMPLE=65536      # je 64 KiB Kopf+Ende
## PERIODIC_REVERIFY_DAYS=7   # alle 7 Tage Vollverifikation trotz unverändertem mtime
####################### ENDE Detail-Doku ###################################

# Entropie-Engine – nutzt 'ent' ab 2 MiB, sonst NumPy; 30s Timeout; 4 MiB Chunk; 3 Heavy-Worker
USE_ENT=1
ENT_THRESHOLD=2097152
ENT_TIMEOUT=30
CHUNK_SIZE=4194304
WORKERS=3

##### Health Check (für Backup-Gating): entropywatcher health window & thresholds #####
# Wird vom status-Command genutzt, um RTB/pCloud-Backup zu gatekeepen
HEALTH_WINDOW_MIN=120          # Minuten, in denen aktuelle Läufe erwartet werden
HEALTH_AV_FINDINGS_MAX=0       # max. AV-Funde im Fenster
HEALTH_FLAGGED_MAX=0           # max. flagged Dateien im Fenster
HEALTH_SAFEAGE_MIN=10          # Mindestalter (Min) seit letztem grünen Scan


# Heuristiken/Härtung – absoluter Schwellenwert, Sprung-Detektion, Quick-Fingerprint, Stichprobengröße, periodische Vollverifikation (Tage)
ALERT_ENTROPY_ABS=7.8
ALERT_ENTROPY_JUMP=0.2
QUICK_FINGERPRINT=1
QUICK_FP_SAMPLE=65536
PERIODIC_REVERIFY_DAYS=7

# Logging (Level global; LOG_FILE meist pro Service/ENV setzen oder leer lassen → stdout/journal)
LOG_LEVEL=INFO

##### EXCLUDES - Für EntropyWatcher-Scans (nas.env, os.env) #####
# Diese EXCLUDES gelten für Entropie-Analyse, NICHT für ClamAV!
# False-Positives aus deinen Mails:
# - .git/objects: Git komprimiert → hohe Entropie (Mail: d0/4c875f...)
# - /boot/*: Kernel/initrd komprimiert (Mail: vmlinuz-*, initrd.img-*)
# - av-quarantine: Bereits isoliert (Mail: /srv/nas/av-quarantine/*)
# - .Spotlight-V100: macOS Index (Mail: .Spotlight-V100/Store-V2/*)

EXCLUDES_MODE=glob
EXCLUDES=*/.git/objects/*,*/.git/logs/*,*/.git/index,/boot/*,*/av-quarantine/*,*/.Spotlight-V100/*,*/node_modules/*,*/__pycache__/*,*/.venv/*,*/venv/*,*.pyc,*.pyo,*.whl,*.gz,*.xz,*.bz2,*.zip,*.tar,*.jar,*.war,*.ear,*.7z,*.rar,*.deb,*.rpm


# Score-Excludes: Messen, aber nicht alarmieren
SCORE_EXCLUDES_MODE=glob
#SCORE_EXCLUDES=*.jpg,*.jpeg,*.png,*.gif,*.mp4,*.mkv,*.avi,*.mp3,*.ogg,*.flac,*.iso,*.sqlite,*.db,*.bin,*.npy
SCORE_EXCLUDES=/opt/apps/entropywatcher/config/*.env,/etc/alternatives/*,*.jpg,*.jpeg,*.png,*.gif,*.mp4,*.mkv,*.avi,*.mp3,*.ogg,*.flac,*.iso,*.sqlite,*.db,*.bin,*.npy,/boot/vmlinuz-*,/boot/initrd.img-*,/boot/firmware/kernel*.img,/boot/firmware/initramfs*,*/.git/objects/*,*/av-quarantine/*,*/_Speedtest/*,*/ew_flag_mail.bin,/usr/local/ew-test/*


##### ClamAV (Defaults; einschalten nur in AV-ENVs!) #####
# CLAMAV_ENABLE=0           <- Standard AUS; nur in nas-av*.env / os-av*.env auf 1 setzen
CLAMAV_ENABLE=0
CLAMAV_USE_CLAMD=1
CLAMAV_EXCLUDES_MODE=glob
CLAMAV_EXCLUDES="/srv/nas/av-quarantine/*,*/.cache/*,*/node_modules/*,*/.venv/*,*/__pycache__/*,*/.git/*,*.iso,*.img,*.vhd,*.vdi,*.qcow2"
CLAMAV_MAX_FILESIZE_MB=1024
CLAMAV_THREADS=1
CLAMAV_TIMEOUT=3600

# Quarantäne
AV_QUARANTINE_DIR=/srv/nas/av-quarantine
AV_QUARANTINE_ACTION=move    # move|copy|chmod|none
AV_QUARANTINE_CHMOD=000      # nur bei ACTION=chmod relevant

MAIL_FROM=<YOUR_EMAIL>
